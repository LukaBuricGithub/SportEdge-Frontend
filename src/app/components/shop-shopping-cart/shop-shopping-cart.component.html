<div class="container my-4">
  <div class="card p-3">
    <div>
      <h2>Your Shopping Cart</h2>
    </div>

    
    <div *ngIf="loading; else cartContent" class="d-flex justify-content-center align-items-center min-vh-100">
  <mat-spinner></mat-spinner>
</div>


    <ng-template #cartContent>
      <ng-container *ngIf="cart?.cartItems && cart.cartItems.length > 0; else emptyCart">

        <div *ngFor="let item of cart.cartItems" class="row align-items-center border-bottom py-3 gx-2">

          <!-- Combined image, name, size, price block -->
          <div class="col-12 col-md-5 d-flex flex-column align-items-center text-center text-md-start">
            <a [routerLink]="['/shop/product-details']" [queryParams]="{ productId: item.productId }">
              <img [src]="item.imageUrl" [alt]="item.productName" class="img-fluid rounded cart-item-img">
            </a>
            <a [routerLink]="['/shop/product-details']" [queryParams]="{ productId: item.productId }"
              class="text-decoration-none text-dark fw-bold mt-2">
              {{ item.productName }}
            </a>
            <span class="text-muted mt-1">Size: {{ item.sizeOptionName }}</span>
            <span>{{ item.priceAtTime | currency:'EUR':'symbol':'1.2-2' }}</span>
          </div>

          <!-- Quantity -->
          <div class="col-12 col-md-3 mt-2 mt-md-0">
            <mat-form-field appearance="outline" class="cart-quantity-field">
              <mat-select [value]="item.quantity" (selectionChange)="onQuantityChange($event, item)">
                <mat-option *ngFor="let q of quantityOptions" [value]="q">
                  {{ q }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <!-- Total -->
          <div class="col-6 col-md-2 fw-semibold text-start text-md-end mt-2 mt-md-0">
            {{ item.priceAtTime * item.quantity | currency:'EUR':'symbol':'1.2-2' }}
          </div>

          <!-- Remove button -->
          <div class="col-6 col-md-2 text-end mt-2 mt-md-0">
            <button mat-icon-button color="warn" disableRipple class="icon-button" (click)="removeItem(item)"
              aria-label="Remove item">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </div>

        <div class="row mt-4">
          <div class="col text-center text-md-end">
            <h4>
              Total: {{ getCartTotal() | currency:'EUR':'symbol':'1.2-2' }}
            </h4>
          </div>
        </div>

        <div class="row mt-2">
          <div class="col text-center text-md-end">
            <button mat-flat-button color="primary" (click)="clearCart()">Checkout</button>
          </div>
        </div>

      </ng-container>
    </ng-template>

    <ng-template #emptyCart>
      <div class="text-center my-4">
        <h4>Your shopping cart is empty.</h4>
      </div>
    </ng-template>

  </div>
</div>
